---
phase: 08-polish-and-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/cli-rust/src/commands/uninstall.rs
autonomous: true

must_haves:
  truths:
    - "Running `occ uninstall` prompts for confirmation before removing service"
    - "Using `--force` skips the confirmation prompt"
    - "After uninstall completes, user sees paths to remaining files (config, data)"
    - "User is informed how to manually clean up remaining files"
  artifacts:
    - path: "packages/cli-rust/src/commands/uninstall.rs"
      provides: "Confirmation prompt and remaining files display"
      contains: "Confirm::new"
  key_links:
    - from: "packages/cli-rust/src/commands/uninstall.rs"
      to: "opencode_cloud_core::config::paths"
      via: "get_config_dir, get_data_dir imports"
      pattern: "get_config_dir|get_data_dir"
---

<objective>
Improve uninstall command UX with confirmation prompt and remaining file path display.

Purpose: Complete INST-06 by making uninstall safer (confirmation) and more informative (show what remains)
Output: Updated uninstall.rs with confirmation prompt and post-uninstall guidance
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-polish-and-documentation/08-CONTEXT.md

# Existing patterns to follow
@packages/cli-rust/src/commands/install.rs (dialoguer Confirm pattern)
@packages/cli-rust/src/commands/user/remove.rs (confirmation + --force pattern)
@packages/core/src/config/paths.rs (get_config_dir, get_data_dir exports)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add confirmation prompt to uninstall</name>
  <files>packages/cli-rust/src/commands/uninstall.rs</files>
  <action>
Add confirmation prompt to uninstall command following the pattern in user/remove.rs:

1. Add `use dialoguer::Confirm;` import
2. Add `use opencode_cloud_core::config::paths::{get_config_dir, get_data_dir};` import
3. After the "service not installed" check and before stopping the container, add confirmation prompt:
   - If `!args.force`, prompt: "This will remove the service registration. Continue? (Y/n)"
   - Use `Confirm::new().with_prompt(...).default(false).interact()?`
   - If user declines, print "Cancelled." and return Ok(())
4. Keep existing --volumes --force validation at the top (separate from general confirmation)

The confirmation should happen BEFORE any destructive action (before stopping container).
  </action>
  <verify>
Build: `just build`
Test: `./target/release/occ uninstall --help` shows --force flag
Test (if service installed): `./target/release/occ uninstall` should prompt before any action
  </verify>
  <done>
Running `occ uninstall` prompts "This will remove the service registration. Continue?" unless --force is passed
  </done>
</task>

<task type="auto">
  <name>Task 2: Display remaining file paths after uninstall</name>
  <files>packages/cli-rust/src/commands/uninstall.rs</files>
  <action>
After the current "Print what was removed" section (line ~84), add a new section showing remaining files:

1. Add a "Files retained" section with:
   - Config directory: `~/.config/opencode-cloud/`
   - Data directory: `~/.local/share/opencode-cloud/` (note: may not exist)

2. Use `get_config_dir()` and `get_data_dir()` to get actual paths

3. Format output like:
   ```
   Files retained (for reinstall):
     Config: ~/.config/opencode-cloud/
     Data:   ~/.local/share/opencode-cloud/

   To completely remove all files:
     rm -rf ~/.config/opencode-cloud ~/.local/share/opencode-cloud
   ```

4. Only show this section if `!quiet`

5. Show the actual resolved paths using the path functions, not hardcoded strings
  </action>
  <verify>
Build: `just build`
Lint: `just lint` passes
Test: `just test` passes
  </verify>
  <done>
After uninstall completes, user sees paths to remaining files and instructions for manual cleanup
  </done>
</task>

</tasks>

<verification>
1. Build passes: `just build`
2. Lint passes: `just lint`
3. Tests pass: `just test`
4. Format check: `just fmt`
5. Manual test (if service installed):
   - `occ uninstall` prompts for confirmation
   - Answering 'n' cancels without changes
   - `occ uninstall --force` skips prompt
   - After uninstall, remaining file paths are displayed
</verification>

<success_criteria>
- INST-06 complete: User can cleanly uninstall via `occ uninstall` with confirmation
- Uninstall shows remaining file paths for manual cleanup
- All pre-commit checks pass (fmt, lint, test, build)
</success_criteria>

<output>
After completion, create `.planning/phases/08-polish-and-documentation/08-01-SUMMARY.md`
</output>
